<!DOCTYPE html>
<html>
<head>
</head>
<body>
  <div id="normal-screen">
<h1>Very basic vpn</h1>
<input placeholder="input token here">
<input placeholder="input url here">
  <button onclick="go();">Go!</button>
<br>
  <br>
  <p>If you want a token, then please go to <a href="tokens.txt">this link</a>, and copy and paste a token. If none work, please let me know via email :)</p>
  </div>
  <div id="vpn-screen">
<h1>Loading...</h1>
  </div>
  <script>
      function decodeStr(input) {
  const chars = 'MZAPLQXKOSWNCDJIEBVFHRUGYTzmxncbvlaksjdhfgqpwoeiruty5049382716/+';
  let output = '';
  let i = 0;

  input = input.replace(/[^A-Za-z0-9\+\/\=]/g, '');

  while (i < input.length) {
    const index1 = chars.indexOf(input.charAt(i++));
    const index2 = chars.indexOf(input.charAt(i++));
    const index3 = chars.indexOf(input.charAt(i++));
    const index4 = chars.indexOf(input.charAt(i++));
    const a = (index1 << 2) | (index2 >> 4);
    const b = ((index2 & 15) << 4) | (index3 >> 2);
    const c = ((index3 & 3) << 6) | index4;

    output += String.fromCharCode(a);
    if (index3 !== 64) output += String.fromCharCode(b);
    if (index4 !== 64) output += String.fromCharCode(c);
  }

  return output;
}
function encodeStr(input) {
  const chars = 'MZAPLQXKOSWNCDJIEBVFHRUGYTzmxncbvlaksjdhfgqpwoeiruty5049382716/+';
  let output = '';
  let i = 0;

  while (i < input.length) {
    const a = input.charCodeAt(i++);
    const b = input.charCodeAt(i++);
    const c = input.charCodeAt(i++);
    const index1 = a >> 2;
    const index2 = ((a & 3) << 4) | (b >> 4);
    const index3 = isNaN(b) ? 64 : ((b & 15) << 2) | (c >> 6);
    const index4 = isNaN(c) ? 64 : c & 63;

    output += chars.charAt(index1) + chars.charAt(index2) + chars.charAt(index3) + chars.charAt(index4);
  }

  return output;
}
async function registerSW(url, scope, token) {
  if(token){
  if (!navigator.serviceWorker) {
    alert("VPN doesn't work, since your browser doesn't support service workers. Sorry!");
  }
  await navigator.serviceWorker.register(url, {
    token: token,
    scope: scope,
  });
  } else{
      if (!navigator.serviceWorker) {
    alert("VPN doesn't work, since your browser doesn't support service workers. Sorry!");
  }
  await navigator.serviceWorker.register(url, {
    scope: scope,
  });
  }
}
    async function importScriptFromUrl(url){
      var thefetch = await fetch(url);
      await eval(thefetch.text());
    }

    function go(){
  location.hash = btoa("['" + document.querySelectorAll("input")[0].value + "', '" + document.querySelectorAll("input")[1].value + "']");
  window.location.reload();
  }
  if(location.hash != ''){
    var thearray = eval(atob(location.hash.slice(1)));
    var pathname = window.location.pathname;

// Remove the filename and any trailing slashes
var url = pathname.substring(0, pathname.lastIndexOf('/') + 1);
    console.log(url);
    document.querySelector("#normal-screen").style.display = 'none';
async function getFromUrl(url1) {
    try {
        console.log("Starting getFromUrl function");
        var response = [];
        var thetext = [];
        for (var i = 0; i < url1.length; i++) {
            response[i] = await fetch(url1[i]);
            console.log("Fetched from URL:", url1[i]);
            thetext[i] = await response[i].text();
            console.log("Response text:", thetext[i]);
            thetext[i] = await thetext[i].replace(/theserviceworkerscriptscope/g, url.slice(0, url.length - 1)).replace(/thebareservernodeurl/g, atob(thearray[0]));
            console.log("Modified text:", thetext[i]);
            thetext[i] = await encodeStr(thetext[i]);
            console.log("Encoded text:", thetext[i]);
        }
        console.log("Registering service worker");
        registerSW("vpn.sw.js?token=" + thearray[0] + "&scope=" + url + "&config=" + thetext[0] + "&sw=" + thetext[1] + "&bundle=" + thetext[2] + "&handler=" + thetext[3], url, thearray[0]);
        console.log("Service worker registered");
        window.location.reload();
    } catch (e) {
        console.error("Error in getFromUrl:", e);
        return "";
    }
}
    getFromUrl([url + "vpn/uv.config.js", url + "vpn/uv.sw.js", url + "vpn/uv.bundle.js", url + "vpn/uv.handler.js"]);
    importScriptFromUrl(url + "uv/uv.bundle.js");
    importScriptFromUrl(url + "uv/uv.config.js");
    registerSW("dist/sw.js", __uv$config.prefix, null);
    location.href = __uv$config.prefix + __uv$config.encodeUrl(thearray[1]);
  } else{
    document.querySelector("#vpn-screen").style.display = 'none';
  }</script>
</body>
</html>
