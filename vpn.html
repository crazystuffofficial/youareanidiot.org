<!DOCTYPE html>
<html>
<head>
</head>
<body>
  <div id="normal-screen">
<h1>Very basic vpn</h1>
<input placeholder="input token here">
<input placeholder="input url here">
  <button onclick="go();">Go!</button>
<br>
  <br>
  <p>If you want a token, then please go to <a href="tokens.txt">this link</a>, and copy and paste a token. If none work, please let me know via email :)</p>
  </div>
  <div id="vpn-screen">
<h1>Loading...</h1>
  </div>
  <script>
    function unregisterAllServiceWorkers(){
navigator.serviceWorker.getRegistrations().then(registrations => {
    for (const registration of registrations) {
        registration.unregister();
    } 
});
  }
      function decodeStr(input) {
  const chars = 'MZAPLQXKOSWNCDJIEBVFHRUGYTzmxncbvlaksjdhfgqpwoeiruty5049382716/+';
  let output = '';
  let i = 0;

  input = input.replace(/[^A-Za-z0-9\+\/\=]/g, '');

  while (i < input.length) {
    const index1 = chars.indexOf(input.charAt(i++));
    const index2 = chars.indexOf(input.charAt(i++));
    const index3 = chars.indexOf(input.charAt(i++));
    const index4 = chars.indexOf(input.charAt(i++));
    const a = (index1 << 2) | (index2 >> 4);
    const b = ((index2 & 15) << 4) | (index3 >> 2);
    const c = ((index3 & 3) << 6) | index4;

    output += String.fromCharCode(a);
    if (index3 !== 64) output += String.fromCharCode(b);
    if (index4 !== 64) output += String.fromCharCode(c);
  }

  return output;
}
function encodeStr(input) {
  const chars = 'MZAPLQXKOSWNCDJIEBVFHRUGYTzmxncbvlaksjdhfgqpwoeiruty5049382716/+';
  let output = '';
  let i = 0;

  while (i < input.length) {
    const a = input.charCodeAt(i++);
    const b = input.charCodeAt(i++);
    const c = input.charCodeAt(i++);
    const index1 = a >> 2;
    const index2 = ((a & 3) << 4) | (b >> 4);
    const index3 = isNaN(b) ? 64 : ((b & 15) << 2) | (c >> 6);
    const index4 = isNaN(c) ? 64 : c & 63;

    output += chars.charAt(index1) + chars.charAt(index2) + chars.charAt(index3) + chars.charAt(index4);
  }

  return output;
}
async function registerSW(url, scope, token) {
  if(token){
  if (!navigator.serviceWorker) {
    alert("VPN doesn't work, since your browser doesn't support service workers. Sorry!");
  }
  await navigator.serviceWorker.register(url, {
    token: token,
    scope: scope,
  });
  } else{
      if (!navigator.serviceWorker) {
    alert("VPN doesn't work, since your browser doesn't support service workers. Sorry!");
  }
  await navigator.serviceWorker.register(url, {
    scope: scope,
  });
  }
  if(localStorage.getItem("first")){
    alert("ye");
const bundleScript = document.createElement('script');
bundleScript.src = url + "uv/uv.bundle.js";
bundleScript.onload = () => {
  const configScript = document.createElement('script');
  configScript.src = url + "uv/uv.config.js";
  configScript.onload = () => {
    localStorage.setItem("first", false);
    registerSW("dist.sw.js", __uv$config.prefix, null);
  };
  configScript.onerror = error => {
    alert('Error loading the config script:', error);
  };
  document.body.appendChild(configScript);
};
bundleScript.onerror = error => {
  alert('Error loading the bundle script:', error);
};
document.body.appendChild(bundleScript);
} else{
    alert("nah");
    location.href = __uv$config.prefix + __uv$config.encodeUrl(thearray[1]);
}
}
    async function importScriptFromUrl(url){
      var thefetch = await fetch(url);
      await eval(thefetch.text());
    }

    function go(){
  location.hash = btoa("['" + document.querySelectorAll("input")[0].value + "', '" + document.querySelectorAll("input")[1].value + "']");
  window.location.reload();
  }
  if(location.hash != ''){
    var thearray = eval(atob(location.hash.slice(1)));
    var pathname = window.location.pathname;

// Remove the filename and any trailing slashes
var url = pathname.substring(0, pathname.lastIndexOf('/') + 1);
    console.log(url);
    document.querySelector("#normal-screen").style.display = 'none';
    localStorage.setItem("first", true);
    registerSW("vpn.sw.js?scope=" + btoa(url) + "&token=" + thearray[0], url, thearray[0]);
  } else{
    document.querySelector("#vpn-screen").style.display = 'none';
  }</script>
</body>
</html>
